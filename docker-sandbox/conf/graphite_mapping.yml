mappings:

  # HELP spark_application_1676167193718_0012_applicationMaster_numContainersPendingAllocate Metric autogenerated by statsd_exporter.
  # TYPE spark_application_1676167193718_0012_applicationMaster_numContainersPendingAllocate gauge
  - match: "graphite\\.(\\w+)\\.applicationMaster\\.(\\w+)"
    name: "spark_applicationMaster"
    match_type: regex
    labels:
      app_id: "${1}"
      key: "${2}"
      type: "gauge"

  ## These come from the application driver
  ## Emulate timer (keep only count attribute) plus counters for LiveListenerBus
  - match: "graphite\\.(.*)\\.driver\\.(DAGScheduler|BlockManager|jvm)\\.(.*)"
    name: "spark_driver_${2}_${3}"
    match_type: regex
    labels:
      app_id: "${1}"
      type: "gauge"

  ## These come from the application driver
  ## Emulate timer (keep only count attribute) plus counters for LiveListenerBus
  - match: "graphite\\.(.*)\\.driver\\.DAGScheduler\\.(.*)"
    name: "spark_driver_DAGScheduler_$2_total"
    match_type: regex
    labels:
      app_id: "${1}"
      type: "counter"

  ## These come from the application driver
  ## Emulate timer (keep only count attribute) plus counters for LiveListenerBus
  - match: "graphite\\.(\\w+)\\.driver\\.LiveListenerBus\\.(\\w+)"
    name: "spark_driver_LiveListenerBus_${2}_total"
    match_type: regex
    labels:
      app_id: "${1}"
      type: "counter"

  ## These come from the application driver
  ## Emulate timer (keep only count attribute) plus counters for LiveListenerBus
  # TYPE graphite_local_1676210808794_driver_LiveListenerBus_listenerProcessingTime_org_apache_spark_HeartbeatReceiver_count gauge
  - match: "graphite\\.(\\w+)\\.driver\\.LiveListenerBus\\.(\\w+)"
    name: "spark_driver_LiveListenerBus_${2}"
    match_type: regex
    labels:
      app_id: "${1}"
      type: "gauge"

  # These come from the application driver if it's a streaming application
  # Example: app-20160809000059-0000.driver.com.example.ClassName.StreamingMetrics.streaming.lastCompletedBatch_schedulingDelay
  - match: "graphite\\.(.*)\\.driver\\.(.*)\\.StreamingMetrics\\.streaming\\.(.*)"
    name: "spark_driver_streaming_$3"
    match_type: regex
    labels:
      app_id: "${1}"
      app_name: "${2}"
      type: "gauge"

  # These come from the application driver if it's a structured streaming application
  # Example: app-20160809000059-0000.driver.spark.streaming.QueryName.inputRate-total
  - match: "graphite\\.(.*)\\.driver\\.graphite\\.streaming\\.(.*)\\.(.*)"
    name: "spark_driver_structured_streaming_${3}"
    match_type: regex
    labels:
      app_id: "${1}"
      query_name: "${2}"
      type: "gauge"


  ##  app-20160809000059-0000.0.executor.threadpool.activeTasks (value)
  ##  app-20160809000059-0000.0.executor.JvmGCtime (counter)
  - match: "graphite\\.(.*)\\.(.*)\\.executor\\.filesystem\\.(.*)"
    name: "spark_executor_filesystem_${3}_total"
    match_type: regex
    labels:
      app_id: "${1}"
      executor_id: "${2}"
      type: "counter"

  # HELP spark_application_1676167193718_0012_driver_ExecutorMetrics_MinorGCTime Metric autogenerated by statsd_exporter.
  # TYPE spark_application_1676167193718_0012_driver_ExecutorMetrics_MinorGCTime gauge
  - match: "graphite\\.(.*)\\.(.*)\\.executor\\.(.*)"
    name: "spark_executor_${3}"
    match_type: regex
    labels:
      app_id: "${1}"
      executor_id: "${2}"
      type: "gauge"

  # HELP spark_application_1676167193718_0012_driver_ExecutorMetrics_MinorGCTime Metric autogenerated by statsd_exporter.
  # TYPE spark_application_1676167193718_0012_driver_ExecutorMetrics_MinorGCTime gauge
  - match: "graphite\\.(.*)\\.(.*)\\.executor\\.(.*)"
    name: "spark_executor_${3}_total"
    match_type: regex
    labels:
      app_id: "${1}"
      executor_id: "${2}"
      type: "counter"

  # HELP spark_application_1676167193718_0012_driver_ExecutorMetrics_MinorGCTime Metric autogenerated by statsd_exporter.
  # TYPE spark_application_1676167193718_0012_driver_ExecutorMetrics_MinorGCTime gauge
  - match: "graphite\\.(.*)\\.(.*)\\.ExecutorMetrics\\.(.*)"
    name: "spark_executor_${3}"
    match_type: regex
    labels:
      app_id: "${1}"
      executor_id: "${2}"
      type: "gauge"


  ## These come from the application executors
  ## Example: app-20160809000059-0000.0.jvm.threadpool.activeTasks
  # HELP spark_application_1676167193718_0012_2_executor_threadpool_activeTasks Metric autogenerated by statsd_exporter.
  # TYPE spark_application_1676167193718_0012_2_executor_threadpool_activeTasks gauge
  - match: "graphite\\.(\\w+)\\.([0-9]+)\\.(jvm|NettyBlockTransfer)\\.(\\w+)"
    name: "spark_executor_${3}_${4}"
    match_type: regex
    labels:
      app_id: "${1}"
      executor_id: "${2}"
      type: "gauge"


  ## These come from the application driver
  ## Emulate timer (keep only count attribute) plus counters for LiveListenerBus
  - match: "graphite\\.(.*)\\.driver\\.HiveExternalCatalog\\.(.*)"
    name: "spark_driver_HiveExternalCatalog_${2}_total"
    match_type: regex
    labels:
      app_id: "${1}"
      executor_id: "driver"
      type: "counter"


  ## These come from the application driver
  ## Emulate timer (keep only count attribute) plus counters for LiveListenerBus
  - match: "graphite\\.(.*)\\.([0-9]+)\\.HiveExternalCatalog\\.(.*)"
    name: "spark_executor_HiveExternalCatalog_${3}_total"
    match_type: regex
    labels:
      app_id: "${1}"
      executor_id: "${2}"
      type: "counter"

  ## These come from the application driver
  ## Emulate timer (keep only count attribute) plus counters for LiveListenerBus
  - match: "graphite\\.(.*)\\.driver\\.CodeGenerator\\.(.*)"
    name: "spark_driver_CodeGenerator_${2}_total"
    match_type: regex
    labels:
      app_id: "${1}"
      executor_id: "driver"
      type: "counter"

  ## These come from the application driver
  ## Emulate timer (keep only count attribute) plus counters for LiveListenerBus
  - match: "graphite\\.(.*)\\.([0-9]+)\\.CodeGenerator\\.(.*)"
    name: "spark_executor_CodeGenerator_${3}_total"
    match_type: regex
    labels:
      app_id: "${1}"
      executor_id: "${2}"
      type: "counter"

  # HELP spark_application_1676201956571_0002_driver_appStatus_jobs_failedJobs Metric autogenerated by statsd_exporter.
  # TYPE spark_application_1676201956571_0002_driver_appStatus_jobs_failedJobs counter
  - match: "graphite\\.(\\w+)\\.driver\\.appStatus\\.(\\w+)"
    name: "spark_driver_appStatus_${2}_total"
    match_type: regex
    labels:
      app_id: "${1}"
      executor_id: "driver"
      type: "gauge"

  # HELP spark_application_1676201956571_0002_driver_JVMCPU_jvmCpuTime Metric autogenerated by statsd_exporter.
  # TYPE spark_application_1676201956571_0002_driver_JVMCPU_jvmCpuTime gauge
  - match: "graphite\\.(.*)\\.driver\\.JVMCPU\\.(.*)"
    name: "spark_driver_JVMCPU_${2}_total"
    match_type: regex
    labels:
      app_id: "${1}"
      executor_id: "driver"
      type: "gauge"

  # HELP spark_application_1676201956571_0002_1_JVMCPU_jvmCpuTime Metric autogenerated by statsd_exporter.
  # TYPE spark_application_1676201956571_0002_1_JVMCPU_jvmCpuTime gauge
  - match: "graphite\\.(.*)\\.([0-9]+)\\.JVMCPU\\.(.*)"
    name: "spark_executor_JVMCPU_${3}_total"
    match_type: regex
    labels:
      app_id: "${1}"
      executor_id: "${2}"
      type: "gauge"
